import{$ as M,A as c,Ba as y,Ca as B,D as v,E as h,Ea as z,F as l,Ga as H,H as d,I as x,J as w,Ja as E,Ka as I,Q as D,X as V,Y as L,Z as S,ha as N,i as b,ia as A,ja as F,ka as j,m as T,ma as O,o as C,oa as R,p as k,pa as P,q as _,r as g,t as a,u,ua as q,v as p,w as s,xa as G,y as o,z as r,za as $}from"./chunk-5BKUYLAT.js";var J=t=>({"is-invalid":t});function ee(t,m){t&1&&(o(0,"div",6),c(1,"span",7),d(2," Loading... "),r())}function te(t,m){if(t&1){let e=v();o(0,"div",8),d(1),o(2,"button",9),h("click",function(){_(e);let n=l();return g(n.error="")}),r()()}if(t&2){let e=l();a(),w(" ",e.error," ")}}function ie(t,m){t&1&&(o(0,"div"),d(1,"Name is required"),r())}function ne(t,m){if(t&1&&(o(0,"div",21),p(1,ie,2,0,"div",22),r()),t&2){let e=l(2);a(),s("ngIf",e.f.name.errors.required)}}function re(t,m){t&1&&(o(0,"div"),d(1,"Description is required"),r())}function oe(t,m){if(t&1&&(o(0,"div",21),p(1,re,2,0,"div",22),r()),t&2){let e=l(2);a(),s("ngIf",e.f.description.errors.required)}}function ae(t,m){t&1&&c(0,"span",23)}function se(t,m){if(t&1){let e=v();o(0,"form",10),h("ngSubmit",function(){_(e);let n=l();return g(n.onSubmit())}),o(1,"div",11)(2,"label",12),d(3,"Name"),r(),c(4,"input",13),p(5,ne,2,1,"div",14),r(),o(6,"div",11)(7,"label",12),d(8,"Description"),r(),c(9,"input",15),p(10,oe,2,1,"div",14),r(),o(11,"div",16)(12,"button",17),p(13,ae,1,0,"span",18),d(14," Save "),r(),c(15,"span",19),o(16,"button",20),d(17,"Cancel"),r()()()}if(t&2){let e=l();s("formGroup",e.form),a(4),s("ngClass",D(8,J,e.submitted&&e.f.name.errors)),a(),s("ngIf",e.submitted&&e.f.name.errors),a(4),s("ngClass",D(10,J,e.submitted&&e.f.description.errors)),a(),s("ngIf",e.submitted&&e.f.description.errors),a(2),s("disabled",e.submitting),a(),s("ngIf",e.submitting),a(3),s("disabled",e.submitting)}}var Q=(()=>{class t{constructor(e,i,n,f,W){this.formBuilder=e,this.departmentService=i,this.alertService=n,this.route=f,this.router=W,this.loading=!1,this.submitting=!1,this.submitted=!1,this.error=""}ngOnInit(){this.id=this.route.snapshot.params.id,this.isAddMode=!this.id,this.form=this.formBuilder.group({name:["",A.required],description:["",A.required]}),this.isAddMode||(this.loading=!0,this.departmentService.getById(this.id).pipe(b()).subscribe({next:e=>{this.form.patchValue(e),this.loading=!1},error:e=>{this.error="Error loading department data",this.alertService.error(this.error),this.loading=!1,console.error("Error loading department:",e)}}))}get f(){return this.form.controls}onSubmit(){if(this.submitted=!0,this.error="",this.alertService.clear(),this.form.invalid)return;this.submitting=!0;let e={name:this.form.value.name,description:this.form.value.description};console.log("Submitting department:",e),this.isAddMode?this.createDepartment(e):this.updateDepartment(e)}createDepartment(e){this.departmentService.create(e).pipe(b()).subscribe({next:()=>{this.alertService.success("Department added successfully",{keepAfterRouteChange:!0}),this.router.navigate(["../"],{relativeTo:this.route})},error:i=>{this.error=i?.message||"Error adding department",this.alertService.error(this.error),this.submitting=!1,console.error("Error creating department:",i)}})}updateDepartment(e){this.departmentService.update(this.id,e).pipe(b()).subscribe({next:()=>{this.alertService.success("Department updated successfully",{keepAfterRouteChange:!0}),this.router.navigate(["../../"],{relativeTo:this.route})},error:i=>{this.error=i?.message||"Error updating department",this.alertService.error(this.error),this.submitting=!1,console.error("Error updating department:",i)}})}static{this.\u0275fac=function(i){return new(i||t)(u(q),u(I),u(E),u($),u(y))}}static{this.\u0275cmp=C({type:t,selectors:[["app-add-edit"]],decls:7,vars:4,consts:[[1,"card"],[1,"card-header"],[1,"card-body"],["class","text-center",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],[1,"text-center"],[1,"spinner-border","spinner-border-sm"],[1,"alert","alert-danger"],["type","button",1,"btn-close","float-end",3,"click"],[3,"ngSubmit","formGroup"],[1,"mb-3"],[1,"form-label"],["type","text","formControlName","name",1,"form-control",3,"ngClass"],["class","invalid-feedback",4,"ngIf"],["type","text","formControlName","description",1,"form-control",3,"ngClass"],[1,"text-center","mt-4"],["type","submit",1,"btn","btn-primary",3,"disabled"],["class","spinner-border spinner-border-sm me-1",4,"ngIf"],[2,"display","inline-block","width","10px"],["type","button","routerLink","/admin/departments",1,"btn","btn-secondary",3,"disabled"],[1,"invalid-feedback"],[4,"ngIf"],[1,"spinner-border","spinner-border-sm","me-1"]],template:function(i,n){i&1&&(o(0,"div",0)(1,"h5",1),d(2),r(),o(3,"div",2),p(4,ee,3,0,"div",3)(5,te,3,1,"div",4)(6,se,18,12,"form",5),r()()),i&2&&(a(2),x(n.isAddMode?"Add Department":"Edit Department"),a(2),s("ngIf",n.loading),a(),s("ngIf",n.error),a(),s("ngIf",!n.loading))},dependencies:[V,S,O,N,F,j,R,P,B],styles:[`.invalid-feedback[_ngcontent-%COMP%] {
        display: block;
        width: 100%;
        margin-top: 0.25rem;
        font-size: 80%;
        color: #dc3545;
    }
    
    .is-invalid[_ngcontent-%COMP%] {
        border-color: #dc3545;
    }
    
    .text-danger[_ngcontent-%COMP%] {
        color: #dc3545;
    }
    
    .btn-close[_ngcontent-%COMP%] {
        background: transparent;
        border: 0;
        font-size: 1.5rem;
        padding: 0.25rem;
        cursor: pointer;
        opacity: 0.5;
    }
    
    .btn-close[_ngcontent-%COMP%]:hover {
        opacity: 1;
    }
    
    .float-end[_ngcontent-%COMP%] {
        float: right;
    }`]})}}return t})();function de(t,m){if(t&1){let e=v();o(0,"button",9),h("click",function(){_(e);let n=l();return g(n.add())}),c(1,"i",10),d(2," Add Department "),r()}}function me(t,m){t&1&&(o(0,"div",11),c(1,"span",12),d(2," Loading departments... "),r())}function le(t,m){if(t&1){let e=v();o(0,"div",13)(1,"div",14),d(2),r(),o(3,"button",9),h("click",function(){_(e);let n=l();return g(n.retry())}),d(4,"Retry"),r()()}if(t&2){let e=l();a(2),x(e.error)}}function pe(t,m){if(t&1){let e=v();o(0,"button",9),h("click",function(){_(e);let n=l(2);return g(n.add())}),c(1,"i",10),d(2," Create First Department "),r()}}function ce(t,m){if(t&1&&(o(0,"div",15)(1,"p"),d(2,"No departments found"),r(),p(3,pe,3,0,"button",4),r()),t&2){let e,i=l();a(3),s("ngIf",((e=i.account())==null?null:e.role)==="Admin")}}function ue(t,m){t&1&&c(0,"span",12)}function fe(t,m){t&1&&(o(0,"span"),c(1,"i",24),d(2," Edit"),r())}function _e(t,m){t&1&&c(0,"span",12)}function ge(t,m){t&1&&(o(0,"span"),c(1,"i",26),d(2," Delete"),r())}function ve(t,m){if(t&1){let e=v();o(0,"button",25),h("click",function(){_(e);let n=l().$implicit,f=l(2);return g(f.delete(n.id.toString()))}),p(1,_e,1,0,"span",21)(2,ge,3,0,"span",22),r()}if(t&2){let e=l().$implicit;s("disabled",e.isDeleting),a(),s("ngIf",e.isDeleting),a(),s("ngIf",!e.isDeleting)}}function he(t,m){if(t&1){let e=v();o(0,"tr")(1,"td"),d(2),r(),o(3,"td"),d(4),r(),o(5,"td"),d(6),r(),o(7,"td",19)(8,"button",20),h("click",function(){let n=_(e).$implicit,f=l(2);return g(f.edit(n.id.toString()))}),p(9,ue,1,0,"span",21)(10,fe,3,0,"span",22),r(),p(11,ve,3,3,"button",23),r()()}if(t&2){let e,i=m.$implicit,n=l(2);a(2),x(i.name),a(2),x(i.description),a(2),x(i.employeeCount),a(3),s("ngIf",i.isDeleting),a(),s("ngIf",!i.isDeleting),a(),s("ngIf",((e=n.account())==null?null:e.role)==="Admin")}}function be(t,m){if(t&1&&(o(0,"div",16)(1,"table",17)(2,"thead")(3,"tr")(4,"th"),d(5,"Name"),r(),o(6,"th"),d(7,"Description"),r(),o(8,"th"),d(9,"Employee Count"),r(),o(10,"th"),d(11,"Actions"),r()()(),o(12,"tbody"),p(13,he,12,6,"tr",18),r()()()),t&2){let e=l();a(13),s("ngForOf",e.departments)}}var U=(()=>{class t{constructor(e,i,n,f){this.router=e,this.departmentService=i,this.accountService=n,this.alertService=f,this.departments=[],this.loading=!1,this.deleting=!1,this.error=""}ngOnInit(){this.fetchDepartments()}fetchDepartments(){this.loading=!0,this.error="",this.departmentService.getAll().pipe(b()).subscribe({next:e=>{this.departments=e,this.loading=!1},error:e=>{this.error="Failed to load departments. Please try again later.",this.alertService.error(this.error),this.loading=!1,console.error(e)}})}account(){return this.accountService.accountValue}edit(e){this.router.navigate(["/admin/departments/add-edit",{id:e}])}delete(e){let i=this.departments.find(n=>n.id===parseInt(e));i&&confirm(`Are you sure you want to delete department "${i.name}"?`)&&(this.deleting=!0,i.isDeleting=!0,this.departmentService.delete(e).pipe(b()).subscribe({next:()=>{this.departments=this.departments.filter(n=>n.id!==parseInt(e)),this.alertService.success("Department deleted successfully",{keepAfterRouteChange:!0}),this.deleting=!1},error:n=>{this.alertService.error("Error deleting department"),i.isDeleting=!1,this.deleting=!1,console.error(n)}}))}add(){this.router.navigate(["/admin/departments/add-edit"])}retry(){this.fetchDepartments()}static{this.\u0275fac=function(i){return new(i||t)(u(y),u(I),u(H),u(E))}}static{this.\u0275cmp=C({type:t,selectors:[["app-list"]],decls:11,vars:5,consts:[[1,"departments-container"],[1,"departments-card"],[1,"departments-header"],[1,"fas","fa-building"],["class","departments-btn-create",3,"click",4,"ngIf"],["class","departments-loading",4,"ngIf"],["class","departments-error",4,"ngIf"],["class","departments-empty",4,"ngIf"],["class","departments-table-wrapper",4,"ngIf"],[1,"departments-btn-create",3,"click"],[1,"fas","fa-plus-circle"],[1,"departments-loading"],[1,"spinner-border","spinner-border-sm"],[1,"departments-error"],[1,"alert","alert-danger"],[1,"departments-empty"],[1,"departments-table-wrapper"],[1,"departments-table"],[4,"ngFor","ngForOf"],[1,"departments-actions"],[1,"departments-btn","edit",3,"click"],["class","spinner-border spinner-border-sm",4,"ngIf"],[4,"ngIf"],["class","departments-btn delete",3,"disabled","click",4,"ngIf"],[1,"fas","fa-edit"],[1,"departments-btn","delete",3,"click","disabled"],[1,"fas","fa-trash"]],template:function(i,n){if(i&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),c(4,"i",3),d(5," Departments"),r(),p(6,de,3,0,"button",4),r(),p(7,me,3,0,"div",5)(8,le,5,1,"div",6)(9,ce,4,1,"div",7)(10,be,14,1,"div",8),r()()),i&2){let f;a(6),s("ngIf",((f=n.account())==null?null:f.role)==="Admin"),a(),s("ngIf",n.loading),a(),s("ngIf",!n.loading&&n.error),a(),s("ngIf",!n.loading&&!n.error&&n.departments.length===0),a(),s("ngIf",!n.loading&&!n.error&&n.departments.length>0)}},dependencies:[L,S],encapsulation:2})}}return t})();var xe=[{path:"",component:U},{path:"add-edit",component:Q}],Le=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=k({type:t})}static{this.\u0275inj=T({imports:[M,G,z.forChild(xe)]})}}return t})();export{Le as DepartmentsModule};
