import{e as ee}from"./chunk-JTRDO5AI.js";import{$ as O,A as m,Ba as Z,Ca as I,D as P,E as b,Ea as M,F as p,G as R,Ga as T,H as a,I as w,J as j,Ja as N,K as D,Q as _,X as A,Y as V,Z as y,ha as U,i as v,ia as u,ja as $,ka as B,m as C,ma as G,o as E,oa as z,p as x,pa as H,q as F,qa as J,r as q,ra as K,sa as Q,t as o,u as f,v as c,va as W,w as s,xa as X,y as n,z as t,za as Y}from"./chunk-5BKUYLAT.js";function ae(e,d){e&1&&(n(0,"span",17),m(1,"i",18),a(2," Active "),t())}function se(e,d){e&1&&(n(0,"span",19),m(1,"i",20),a(2," Deactivated "),t())}function de(e,d){if(e&1&&(n(0,"span"),c(1,ae,3,0,"span",15)(2,se,3,0,"span",16),t()),e&2){let i=p().$implicit;o(),s("ngIf",i.isActive),o(),s("ngIf",!i.isActive)}}function le(e,d){e&1&&(n(0,"span",21),a(1,"N/A"),t())}function ce(e,d){e&1&&m(0,"span",24)}function me(e,d){if(e&1&&(n(0,"span"),m(1,"i",25),a(2),t()),e&2){let i=p(2).$implicit;o(),s("ngClass",i.isActive?"fa-user-slash":"fa-user-check"),o(),j(" ",i.isActive?"Deactivate":"Activate"," ")}}function pe(e,d){if(e&1){let i=P();n(0,"button",22),b("click",function(){F(i);let r=p().$implicit,h=p();return q(h.toggleAccountStatus(r.id))}),c(1,ce,1,0,"span",23)(2,me,3,2,"span",9),t()}if(e&2){let i=p().$implicit;s("disabled",i.isToggling)("ngClass",i.isActive?"deactivate":"activate"),o(),s("ngIf",i.isToggling),o(),s("ngIf",!i.isToggling)}}function ue(e,d){if(e&1&&(n(0,"tr")(1,"td"),a(2),t(),n(3,"td"),a(4),t(),n(5,"td"),a(6),t(),n(7,"td"),c(8,de,3,2,"span",9)(9,le,2,0,"span",10),t(),n(10,"td",11)(11,"a",12),m(12,"i",13),a(13," Edit"),t(),c(14,pe,3,4,"button",14),t()()),e&2){let i=d.$implicit;o(2),D("",i.firstName," ",i.lastName,""),o(2),w(i.email),o(2),w(i.role),o(2),s("ngIf",i.role!=="Admin"),o(),s("ngIf",i.role==="Admin"),o(2),R("routerLink","edit/",i.id,""),o(3),s("ngIf",i.role!=="Admin")}}function fe(e,d){e&1&&(n(0,"tr")(1,"td",26),m(2,"span",27),t()())}var te=(()=>{class e{constructor(i,l){this.accountService=i,this.alertService=l,this.loading=!1}ngOnInit(){this.loading=!0,this.accountService.getAll().pipe(v()).subscribe({next:i=>{this.accounts=i,this.loading=!1},error:i=>{this.alertService.error("Error loading accounts: "+(i?.message||"Unknown error")),this.loading=!1}})}deleteAccount(i){let l=this.accounts.find(r=>r.id===i);l.isDeleting=!0,this.accountService.delete(i).pipe(v()).subscribe({next:()=>{this.accounts=this.accounts.filter(r=>r.id!==i),this.alertService.success("Account deleted successfully")},error:r=>{this.alertService.error("Error deleting account: "+(r?.message||"Unknown error")),l.isDeleting=!1}})}toggleAccountStatus(i){let l=this.accounts.find(S=>S.id===i);if(l.role==="Admin"){this.alertService.error("Cannot change status of admin accounts");return}l.isToggling=!0;let r=!l.isActive,h=r?"activated":"deactivated";this.accountService.updateStatus(i,r).pipe(v()).subscribe({next:S=>{l.isActive=r,this.alertService.success(`Account ${h} successfully`),r?this.alertService.info("User can now log in to the system"):this.alertService.warn("User has been blocked from logging in")},error:S=>{this.alertService.error(`Error updating account status: ${S?.message||"Server error occurred"}`)},complete:()=>{l.isToggling=!1}})}static{this.\u0275fac=function(l){return new(l||e)(f(T),f(N))}}static{this.\u0275cmp=E({type:e,selectors:[["ng-component"]],decls:27,vars:2,consts:[[1,"accounts-container"],[1,"accounts-card"],[1,"accounts-header"],[1,"fas","fa-users-cog"],["routerLink","add",1,"accounts-btn-create"],[1,"fas","fa-plus-circle"],[1,"accounts-table-wrapper"],[1,"accounts-table"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","accounts-badge na",4,"ngIf"],[1,"accounts-actions"],[1,"accounts-btn","edit",3,"routerLink"],[1,"fas","fa-edit"],["class","accounts-btn status",3,"disabled","ngClass","click",4,"ngIf"],["class","accounts-badge active",4,"ngIf"],["class","accounts-badge deactivated",4,"ngIf"],[1,"accounts-badge","active"],[1,"fas","fa-check-circle"],[1,"accounts-badge","deactivated"],[1,"fas","fa-times-circle"],[1,"accounts-badge","na"],[1,"accounts-btn","status",3,"click","disabled","ngClass"],["class","spinner-border spinner-border-sm",4,"ngIf"],[1,"spinner-border","spinner-border-sm"],[1,"fas",3,"ngClass"],["colspan","5",1,"text-center"],[1,"spinner-border","spinner-border-lg","align-center"]],template:function(l,r){l&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),m(4,"i",3),a(5," Account"),t(),n(6,"p"),a(7,"All accounts from secure (admin only) api end point:"),t(),n(8,"a",4),m(9,"i",5),a(10," Create Account"),t()(),n(11,"div",6)(12,"table",7)(13,"thead")(14,"tr")(15,"th"),a(16,"Name"),t(),n(17,"th"),a(18,"Email"),t(),n(19,"th"),a(20,"Role"),t(),n(21,"th"),a(22,"Status"),t(),m(23,"th"),t()(),n(24,"tbody"),c(25,ue,15,9,"tr",8)(26,fe,3,0,"tr",9),t()()()()()),l&2&&(o(25),s("ngForOf",r.accounts),o(),s("ngIf",!r.accounts))},dependencies:[A,V,y,I],encapsulation:2})}}return e})();var g=e=>({"is-invalid":e});function ve(e,d){e&1&&(n(0,"h1"),a(1,"Create Account"),t())}function _e(e,d){e&1&&(n(0,"h1"),a(1,"Edit Account"),t())}function ge(e,d){e&1&&(n(0,"div"),a(1,"Title is required"),t())}function he(e,d){if(e&1&&(n(0,"div",25),c(1,ge,2,0,"div",0),t()),e&2){let i=p();o(),s("ngIf",i.f.title.errors.required)}}function Se(e,d){e&1&&(n(0,"div"),a(1,"First Name is required"),t())}function Ce(e,d){if(e&1&&(n(0,"div",25),c(1,Se,2,0,"div",0),t()),e&2){let i=p();o(),s("ngIf",i.f.firstName.errors.required)}}function Ee(e,d){e&1&&(n(0,"div"),a(1,"Last Name is required"),t())}function xe(e,d){if(e&1&&(n(0,"div",25),c(1,Ee,2,0,"div",0),t()),e&2){let i=p();o(),s("ngIf",i.f.lastName.errors.required)}}function be(e,d){e&1&&(n(0,"div"),a(1,"Email is required"),t())}function Ae(e,d){e&1&&(n(0,"div"),a(1,"Email must be a valid email address"),t())}function ye(e,d){if(e&1&&(n(0,"div",25),c(1,be,2,0,"div",0)(2,Ae,2,0,"div",0),t()),e&2){let i=p();o(),s("ngIf",i.f.email.errors.required),o(),s("ngIf",i.f.email.errors.email)}}function Ie(e,d){e&1&&(n(0,"div"),a(1,"Role is required"),t())}function Te(e,d){if(e&1&&(n(0,"div",25),c(1,Ie,2,0,"div",0),t()),e&2){let i=p();o(),s("ngIf",i.f.role.errors.required)}}function Ne(e,d){e&1&&(n(0,"div")(1,"h3",26),a(2,"Change Password"),t(),n(3,"p"),a(4,"Leave Blank to keep the same password"),t()())}function we(e,d){e&1&&(n(0,"div"),a(1,"Password is required"),t())}function Me(e,d){e&1&&(n(0,"div"),a(1,"Password must be at least 6 characters"),t())}function Le(e,d){if(e&1&&(n(0,"div",25),c(1,we,2,0,"div",0)(2,Me,2,0,"div",0),t()),e&2){let i=p();o(),s("ngIf",i.f.password.errors.required),o(),s("ngIf",i.f.password.errors.minlength)}}function ke(e,d){e&1&&(n(0,"div"),a(1,"Confirm Password is required"),t())}function Fe(e,d){e&1&&(n(0,"div"),a(1,"Passwords must match"),t())}function qe(e,d){if(e&1&&(n(0,"div",25),c(1,ke,2,0,"div",0)(2,Fe,2,0,"div",0),t()),e&2){let i=p();o(),s("ngIf",i.f.confirmPassword.errors.required),o(),s("ngIf",i.f.confirmPassword.errors.mustMatch)}}function Pe(e,d){e&1&&m(0,"span",27)}var k=(()=>{class e{constructor(i,l,r,h,S){this.formBuilder=i,this.route=l,this.router=r,this.accountService=h,this.alertService=S,this.loading=!1,this.submitted=!1}ngOnInit(){this.id=this.route.snapshot.params.id,this.isAddMode=!this.id,this.form=this.formBuilder.group({title:["",u.required],firstName:["",u.required],lastName:["",u.required],email:["",[u.required,u.email]],role:["",u.required],password:["",[u.minLength(6),this.isAddMode?u.required:u.nullValidator]],confirmPassword:[""]},{validator:ee("password","confirmPassword")}),this.isAddMode||this.accountService.getById(this.id).pipe(v()).subscribe(i=>this.form.patchValue(i))}get f(){return this.form.controls}onSubmit(){this.submitted=!0,this.alertService.clear(),!this.form.invalid&&(this.loading=!0,this.isAddMode?this.createAccount():this.updateAccount())}createAccount(){this.accountService.create(this.form.value).pipe(v()).subscribe({next:()=>{this.alertService.success("Account created successfully",{keepAfterRouteChange:!0}),this.router.navigate(["../"],{relativeTo:this.route})},error:i=>{this.alertService.error(i),this.loading=!1}})}updateAccount(){this.accountService.update(this.id,this.form.value).pipe(v()).subscribe({next:()=>{this.alertService.success("Account updated successfully",{keepAfterRouteChange:!0}),this.router.navigate(["../"],{relativeTo:this.route})},error:i=>{this.alertService.error(i),this.loading=!1}})}static{this.\u0275fac=function(l){return new(l||e)(f(W),f(Y),f(Z),f(T),f(N))}}static{this.\u0275cmp=E({type:e,selectors:[["ng-component"]],decls:62,vars:34,consts:[[4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"form-row"],[1,"form-group","col"],["formControlName","title",1,"form-control",3,"ngClass"],["value",""],["value","Mr"],["value","Mrs"],["value","Miss"],["value","Ms"],["class","invalid-feedback",4,"ngIf"],[1,"form-group","col-5"],["type","text","formControlName","firstName",1,"form-control",3,"ngClass"],["type","text","formControlName","lastName",1,"form-control",3,"ngClass"],[1,"form-group","col-7"],["type","text","formControlName","email",1,"form-control",3,"ngClass"],["formControlName","role",1,"form-control",3,"ngClass"],["value","User"],["value","Admin"],["type","password","formControlName","password",1,"form-control",3,"ngClass"],["type","password","formControlName","confirmPassword",1,"form-control",3,"ngClass"],[1,"form-group"],[1,"btn","btn-primary",3,"disabled"],["class","spinner-border spinner-border-sm mr-1",4,"ngIf"],["routerLink","/admin/accounts",1,"btn","btn-link"],[1,"invalid-feedback"],[1,"pt-3"],[1,"spinner-border","spinner-border-sm","mr-1"]],template:function(l,r){l&1&&(c(0,ve,2,0,"h1",0)(1,_e,2,0,"h1",0),n(2,"form",1),b("ngSubmit",function(){return r.onSubmit()}),n(3,"div",2)(4,"div",3)(5,"label"),a(6,"Title"),t(),n(7,"select",4),m(8,"option",5),n(9,"option",6),a(10,"Mr"),t(),n(11,"option",7),a(12,"Mrs"),t(),n(13,"option",8),a(14,"Miss"),t(),n(15,"option",9),a(16,"Ms"),t()(),c(17,he,2,1,"div",10),t(),n(18,"div",11)(19,"label"),a(20,"First Name"),t(),m(21,"input",12),c(22,Ce,2,1,"div",10),t(),n(23,"div",11)(24,"label"),a(25,"Last Name"),t(),m(26,"input",13),c(27,xe,2,1,"div",10),t()(),n(28,"div",2)(29,"div",14)(30,"label"),a(31,"Email"),t(),m(32,"input",15),c(33,ye,3,2,"div",10),t(),n(34,"div",3)(35,"label"),a(36,"Role"),t(),n(37,"select",16),m(38,"option",5),n(39,"option",17),a(40,"User"),t(),n(41,"option",18),a(42,"Admin"),t()(),c(43,Te,2,1,"div",10),t()(),c(44,Ne,5,0,"div",0),n(45,"div",2)(46,"div",3)(47,"label"),a(48,"Password"),t(),m(49,"input",19),c(50,Le,3,2,"div",10),t(),n(51,"div",3)(52,"label"),a(53,"Confirm Password"),t(),m(54,"input",20),c(55,qe,3,2,"div",10),t()(),n(56,"div",21)(57,"button",22),c(58,Pe,1,0,"span",23),a(59," Save "),t(),n(60,"a",24),a(61,"Cancel"),t()()()),l&2&&(s("ngIf",r.isAddMode),o(),s("ngIf",!r.isAddMode),o(),s("formGroup",r.form),o(5),s("ngClass",_(20,g,r.submitted&&r.f.title.errors)),o(10),s("ngIf",r.submitted&&r.f.title.errors),o(4),s("ngClass",_(22,g,r.submitted&&r.f.firstName.errors)),o(),s("ngIf",r.submitted&&r.f.firstName.errors),o(4),s("ngClass",_(24,g,r.submitted&&r.f.lastName.errors)),o(),s("ngIf",r.submitted&&r.f.lastName.errors),o(5),s("ngClass",_(26,g,r.submitted&&r.f.email.errors)),o(),s("ngIf",r.submitted&&r.f.email.errors),o(4),s("ngClass",_(28,g,r.submitted&&r.f.role.errors)),o(6),s("ngIf",r.submitted&&r.f.role.errors),o(),s("ngIf",!r.isAddMode),o(5),s("ngClass",_(30,g,r.submitted&&r.f.password.errors)),o(),s("ngIf",r.submitted&&r.f.password.errors),o(4),s("ngClass",_(32,g,r.submitted&&r.f.confirmPassword.errors)),o(),s("ngIf",r.submitted&&r.f.confirmPassword.errors),o(2),s("disabled",r.loading),o(),s("ngIf",r.loading))},dependencies:[A,y,G,K,Q,U,J,$,B,z,H,I],encapsulation:2})}}return e})();var Re=[{path:"",component:te},{path:"add",component:k},{path:"edit/:id",component:k}],ie=(()=>{class e{static{this.\u0275fac=function(l){return new(l||e)}}static{this.\u0275mod=x({type:e})}static{this.\u0275inj=C({imports:[M.forChild(Re),M]})}}return e})();var tt=(()=>{class e{static{this.\u0275fac=function(l){return new(l||e)}}static{this.\u0275mod=x({type:e})}static{this.\u0275inj=C({imports:[O,X,ie]})}}return e})();export{tt as AccountsModule};
