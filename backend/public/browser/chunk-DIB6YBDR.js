import{A as u,B as F,Ba as V,C as k,D as q,E as f,F as m,Ga as $,H as o,I as y,J as b,Ja as N,K as L,Ma as j,Na as D,S,X as A,Y as w,Z as R,c as I,e as C,g as x,i as h,o as E,q as g,r as v,t as l,u as p,v as _,w as c,y as s,z as r,za as T}from"./chunk-5BKUYLAT.js";var M=(n,a,e,i)=>({pending:n,approved:a,rejected:e,completed:i}),U=(n,a,e,i)=>({"fa-hourglass-half":n,"fa-check-circle":a,"fa-times-circle":e,"fa-clipboard-check":i});function B(n,a){n&1&&(s(0,"div",10),u(1,"div",11),s(2,"p",12),o(3,"Loading requests..."),r()())}function J(n,a){if(n&1){let e=q();s(0,"div",13)(1,"p"),o(2),r(),s(3,"button",4),f("click",function(){g(e);let t=m();return v(t.retry())}),o(4,"Retry"),r()()}if(n&2){let e=m();l(2),y(e.error)}}function z(n,a){if(n&1){let e=q();s(0,"div",14)(1,"p"),o(2,"No requests found. Click the button below to add a request."),r(),s(3,"button",4),f("click",function(){g(e);let t=m();return v(t.add())}),u(4,"i",5),o(5," Add Request "),r()()}}function G(n,a){if(n&1&&(s(0,"div",27),o(1),r()),n&2){let e=a.$implicit;l(),L(" ",e.name," (x",e.quantity,") ")}}function H(n,a){if(n&1&&(F(0),_(1,G,2,2,"div",26),k()),n&2){let e=m().$implicit;l(),c("ngForOf",e.requestItems)}}function K(n,a){n&1&&(s(0,"div",28),o(1," No items "),r())}function Q(n,a){if(n&1){let e=q();s(0,"button",29),f("click",function(){g(e);let t=m().$implicit,d=m(2);return v(d.delete(t.id))}),u(1,"i",30),o(2," Delete"),r()}}function W(n,a){if(n&1){let e=q();s(0,"tr")(1,"td"),o(2),r(),s(3,"td"),o(4),r(),s(5,"td"),_(6,H,2,1,"ng-container",18)(7,K,2,0,"div",19),r(),s(8,"td")(9,"span",20),u(10,"i",21),o(11),r()(),s(12,"td",22)(13,"button",23),f("click",function(){let t=g(e).$implicit,d=m(2);return v(d.edit(t.id))}),u(14,"i",24),o(15," Edit"),r(),_(16,Q,3,0,"button",25),r()()}if(n&2){let e,i=a.$implicit,t=m(2);l(2),y(i.type),l(2),y(t.getEmployeeInfo(i.employeeId)),l(2),c("ngIf",i.requestItems&&i.requestItems.length>0),l(),c("ngIf",!i.requestItems||i.requestItems.length===0),l(2),c("ngClass",S(8,M,i.status==="Pending",i.status==="Approved",i.status==="Rejected",i.status==="Completed")),l(),c("ngClass",S(13,U,i.status==="Pending",i.status==="Approved",i.status==="Rejected",i.status==="Completed")),l(),b(" ",i.status," "),l(5),c("ngIf",((e=t.account())==null?null:e.role)==="Admin")}}function X(n,a){if(n&1&&(s(0,"div",15)(1,"table",16)(2,"thead")(3,"tr")(4,"th"),o(5,"Type"),r(),s(6,"th"),o(7,"Employee"),r(),s(8,"th"),o(9,"Items"),r(),s(10,"th"),o(11,"Status"),r(),s(12,"th"),o(13,"Actions"),r()()(),s(14,"tbody"),_(15,W,17,18,"tr",17),r()()()),n&2){let e=m();l(15),c("ngForOf",e.requests)}}var re=(()=>{class n{constructor(e,i,t,d,O,P){this.requestService=e,this.accountService=i,this.employeeService=t,this.alertService=d,this.router=O,this.route=P,this.requests=[],this.employees=[],this.accounts=[],this.loading=!1,this.error="",this.employeeIdFilter=null,this.retryAttempts=0,this.maxRetryAttempts=2}ngOnInit(){this.loading=!0,this.route.queryParams.subscribe(e=>{e.employeeId&&(this.employeeIdFilter=e.employeeId,console.log(`Filtering requests for employee ID: ${this.employeeIdFilter}`))}),C({employees:this.employeeService.getAll().pipe(h(),x(e=>(console.error("Error loading employees:",e),I([])))),accounts:this.accountService.getAll().pipe(h(),x(e=>(console.error("Error loading accounts:",e),I([]))))}).subscribe({next:e=>{this.employees=e.employees||[],this.accounts=e.accounts||[],console.log("Loaded employees:",this.employees.length),console.log("Loaded accounts:",this.accounts.length),this.loadRequests()},error:e=>{console.error("Error loading reference data:",e),this.loadRequests()}})}loadRequests(){this.loading=!0,this.error="",(this.employeeIdFilter?this.requestService.getByEmployee(Number(this.employeeIdFilter)):this.requestService.getAll()).pipe(h()).subscribe({next:i=>{this.requests=i||[],this.requests=this.requests.map(t=>(t.RequestItems&&!t.requestItems?t.requestItems=t.RequestItems:t.requestItems||(t.requestItems=[]),t)),console.log(`Loaded ${this.requests.length} requests with items:`,this.requests.map(t=>({id:t.id,items:t.requestItems?.length||0}))),this.loading=!1},error:i=>{console.error("Error loading requests:",i),this.error="Failed to load requests",this.loading=!1,this.requests.length===0&&this.loadMockData()}})}loadMockData(){console.log("Loading mock request data as fallback"),this.requests=[{id:1,employeeId:this.employeeIdFilter?Number(this.employeeIdFilter):1,type:"Equipment",status:"Pending",requestItems:[{id:1,name:"Laptop",quantity:1},{id:2,name:"Monitor",quantity:2}]},{id:2,employeeId:this.employeeIdFilter?Number(this.employeeIdFilter):2,type:"Office Supplies",status:"Approved",requestItems:[{id:3,name:"Notebooks",quantity:5},{id:4,name:"Pens",quantity:10}]}],this.loading=!1,this.error="Using sample data - API connection failed"}getEmployeeInfo(e){if(!e)return"Unknown";let i=this.employees.find(t=>t.id===e);if(i){let t=this.accounts.find(d=>d.id===i.userId);if(t){let d=t.role==="Admin"?"Admin User":"Normal User";return`${t.email} (${d})`}return`${i.employeeId}`}return`Employee ID: ${e}`}account(){return this.accountService.accountValue}add(){this.employeeIdFilter?this.router.navigate(["/admin/requests/add"],{queryParams:{employeeId:this.employeeIdFilter}}):this.router.navigate(["/admin/requests/add"])}edit(e){this.router.navigate(["/admin/requests/edit",e])}delete(e){this.requests.find(t=>t.id===e)&&confirm("Are you sure you want to delete this request?")&&this.requestService.delete(e.toString()).pipe(h()).subscribe({next:()=>{this.alertService.success("Request deleted successfully"),this.requests=this.requests.filter(t=>t.id!==e)},error:t=>{this.alertService.error("Error deleting request"),console.error("Error deleting request:",t)}})}retry(){this.error="",this.retryAttempts++,this.loadRequests()}static{this.\u0275fac=function(i){return new(i||n)(p(D),p($),p(j),p(N),p(V),p(T))}}static{this.\u0275cmp=E({type:n,selectors:[["ng-component"]],decls:13,vars:5,consts:[[1,"requests-container"],[1,"requests-card"],[1,"requests-header"],[1,"fas","fa-clipboard-list"],[1,"requests-btn-create",3,"click"],[1,"fas","fa-plus-circle"],["class","requests-loading",4,"ngIf"],["class","requests-error",4,"ngIf"],["class","requests-empty",4,"ngIf"],["class","requests-table-wrapper",4,"ngIf"],[1,"requests-loading"],["role","status",1,"spinner-border","text-primary"],[1,"mt-2"],[1,"requests-error"],[1,"requests-empty"],[1,"requests-table-wrapper"],[1,"requests-table"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","text-muted",4,"ngIf"],[1,"requests-badge",3,"ngClass"],[1,"fas",3,"ngClass"],[1,"requests-actions"],[1,"requests-btn","edit",3,"click"],[1,"fas","fa-edit"],["class","requests-btn delete",3,"click",4,"ngIf"],["class","mb-1",4,"ngFor","ngForOf"],[1,"mb-1"],[1,"text-muted"],[1,"requests-btn","delete",3,"click"],[1,"fas","fa-trash"]],template:function(i,t){i&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),u(4,"i",3),o(5),r(),s(6,"button",4),f("click",function(){return t.add()}),u(7,"i",5),o(8," Add Request "),r()(),_(9,B,4,0,"div",6)(10,J,5,1,"div",7)(11,z,6,0,"div",8)(12,X,16,1,"div",9),r()()),i&2&&(l(5),b(" Requests ",t.employeeIdFilter?"for Employee "+t.employeeIdFilter:"",""),l(4),c("ngIf",t.loading),l(),c("ngIf",t.error),l(),c("ngIf",!t.loading&&!t.error&&(t.requests==null?null:t.requests.length)===0),l(),c("ngIf",!t.loading&&!t.error&&(t.requests==null?null:t.requests.length)>0))},dependencies:[A,w,R],encapsulation:2})}}return n})();export{re as a};
